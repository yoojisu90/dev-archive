# ğŸŒ± ê¸°ê¸°ì œì–´ ì‹œìŠ¤í…œ ì™„ì „ ì •ë¦¬

> ì‹ë¬¼ ë†ì¥ ì•±ì˜ IoT ê¸°ê¸° ì œì–´ ë° ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì— ëŒ€í•œ ì™„ì „í•œ ê°€ì´ë“œ

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#-ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì•„í‚¤í…ì²˜](#-ì•„í‚¤í…ì²˜)
3. [ì£¼ìš” ì»´í¬ë„ŒíŠ¸](#-ì£¼ìš”-ì»´í¬ë„ŒíŠ¸)
4. [API ì„œë¹„ìŠ¤](#-api-ì„œë¹„ìŠ¤)
5. [ì‘ì—… íˆìŠ¤í† ë¦¬](#-ì‘ì—…-íˆìŠ¤í† ë¦¬)
6. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
7. [í–¥í›„ ê°œì„ ì‚¬í•­](#-í–¥í›„-ê°œì„ ì‚¬í•­)

---

## ğŸ¯ ì‹œìŠ¤í…œ ê°œìš”

### ê¸°ëŠ¥ ìš”ì•½
- **ì‹¤ì‹œê°„ ì„¼ì„œ ëª¨ë‹ˆí„°ë§**: ì˜¨ë„, ìŠµë„, ì¡°ë„, í† ì–‘ ìˆ˜ë¶„ ë“± ì„¼ì„œ ë°ì´í„° ì¡°íšŒ
- **ê¸°ê¸° ì›ê²© ì œì–´**: PUMP(ë¬¼íŒí”„), FAN(í™˜í’ê¸°), LED(ì¡°ëª…) ì œì–´
- **ìë™/ìˆ˜ë™ ëª¨ë“œ**: AUTO ëª¨ë“œ(ì„¼ì„œ ê¸°ë°˜ ìë™ ì œì–´) / MANUAL ëª¨ë“œ(ì‚¬ìš©ì ì§ì ‘ ì œì–´)
- **ì œì–´ ë¡œê·¸ ì¡°íšŒ**: ëª¨ë“  ê¸°ê¸° ì œì–´ ì´ë ¥ ê¸°ë¡ ë° ì¡°íšŒ

### ì§€ì› ê¸°ê¸°
| ê¸°ê¸°ëª… | ì•„ì´ì½˜ | ì—­í•  | GPIO í•€ | ì œì–´ ë°©ì‹ |
|--------|--------|------|---------|----------|
| **PUMP** | ğŸ’§ | ë¬¼ ê³µê¸‰ íŒí”„ | GPIO 6 | ACTIVE_LOW |
| **FAN** | ğŸ’¨ | í™˜í’ê¸°/ì„ í’ê¸° | GPIO 13 | ACTIVE_HIGH |
| **LED** | ğŸ’¡ | ì‹ë¬¼ ìƒì¥ ì¡°ëª… | GPIO 4 | ACTIVE_HIGH |

---

## ğŸ— ì•„í‚¤í…ì²˜

### ì‹œìŠ¤í…œ êµ¬ì„±ë„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React Native   â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚  Spring Boot     â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚  Raspberry Pi   â”‚
â”‚  Expo App       â”‚       â”‚  Backend API     â”‚       â”‚  (GPIO ì œì–´)    â”‚
â”‚                 â”‚       â”‚                  â”‚       â”‚                 â”‚
â”‚  - ì„¼ì„œ ëª¨ë‹ˆí„°ë§  â”‚â—€â”€â”€â”€â”€â”€â”€â”‚  - REST API      â”‚â—€â”€â”€â”€â”€â”€â”€â”‚  - Python       â”‚
â”‚  - ê¸°ê¸° ì œì–´ UI  â”‚       â”‚  - DB ì—°ë™       â”‚       â”‚  - GPIO ì œì–´    â”‚
â”‚  - ë¡œê·¸ ì¡°íšŒ     â”‚       â”‚  - ë¡œê·¸ ê¸°ë¡     â”‚       â”‚  - ì„¼ì„œ ìˆ˜ì§‘    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²                          â”‚                          â”‚
        â”‚                          â–¼                          â–¼
        â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚   MariaDB    â”‚          â”‚   ì„¼ì„œ ì¥ì¹˜ë“¤   â”‚
        â”‚                  â”‚              â”‚          â”‚  - DHT11       â”‚
        â”‚                  â”‚ - actuator   â”‚          â”‚  - CdS         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ - sensor     â”‚          â”‚  - í† ì–‘ìŠµë„     â”‚
                          â”‚ - member     â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë„¤íŠ¸ì›Œí¬ êµ¬ì„±
```
192.168.30.97:5000    â†’ Spring Boot í†µí•© API ì„œë²„ (ì„¼ì„œ, ì•¡ì¶”ì—ì´í„°, ì±„íŒ… ë“±)
192.168.30.97:8080    â†’ Spring Boot IoT API ì„œë²„ (ê¸°ê¸° ì œì–´ ì „ìš©)
192.168.30.107:8080   â†’ Spring Boot ìº˜ë¦°ë” API ì„œë²„ (ì¼ê¸°, ë¬¼ì£¼ê¸° ì¼ì •)
192.168.30.236        â†’ Raspberry Pi (GPIO ì œì–´ ë° ì„¼ì„œ ë°ì´í„° ìˆ˜ì§‘)
192.168.30.97:3306    â†’ MariaDB ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„
```

> **ì¤‘ìš”**: í˜„ì¬ í”„ë¡ íŠ¸ì—”ë“œëŠ” `192.168.30.97:8080`ì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

---

## ğŸ“¦ ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### 1. FarmManagement.jsx
> ğŸ“ ê²½ë¡œ: `components/myFarm/FarmManagement.jsx`

ë†ì¥ ê´€ë¦¬ ë©”ì¸ í™”ë©´ - ì„¼ì„œ ë°ì´í„° ì¡°íšŒ ë° ê¸°ê¸° ì œì–´ í†µí•© UI

#### ì£¼ìš” ê¸°ëŠ¥
```jsx
// 1. ì„¼ì„œ ë°ì´í„° ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
const loadSensorData = async () => {
  const data = await fetchSensorData();
  setSensorData(data);
};

// 2. ì•¡ì¶”ì—ì´í„° ìƒíƒœ ì¡°íšŒ
const loadActuatorStatus = async () => {
  const actuators = ['PUMP', 'FAN', 'LED'];
  const statusPromises = actuators.map(async (actName) => {
    const status = await fetchActuatorStatus(raspNum, actName);
    return { [actName]: status };
  });
  const statuses = await Promise.all(statusPromises);
  setActuatorStatus(statuses);
};

// 3. ê¸°ê¸° ì œì–´ í•¸ë“¤ëŸ¬
const handleActuatorControl = async (actName, command) => {
  if (command === 'AUTO') {
    // AUTO ëª¨ë“œë¡œ ì „í™˜
    await controlActuator(raspNum, actName, 'AUTO');
    setActuatorStatus(prev => ({
      ...prev,
      [actName]: { state: 'AUTO', mode: 'AUTO' }
    }));
  } else {
    // MANUAL ëª¨ë“œë¡œ ON/OFF
    await controlActuator(raspNum, actName, command);
    setActuatorStatus(prev => ({
      ...prev,
      [actName]: { state: command, mode: 'MANUAL' }
    }));
  }
};

// 4. ëª¨ë“  ê¸°ê¸° AUTO ì´ˆê¸°í™”
const resetAllToAuto = async () => {
  await Promise.all([
    controlActuator(raspNum, 'PUMP', 'AUTO'),
    controlActuator(raspNum, 'FAN', 'AUTO'),
    controlActuator(raspNum, 'LED', 'AUTO')
  ]);
};
```

#### State ê´€ë¦¬
| State | íƒ€ì… | ìš©ë„ |
|-------|------|------|
| `sensorData` | Object | ì„¼ì„œ ë°ì´í„° (ì˜¨ë„, ìŠµë„, ì¡°ë„ ë“±) |
| `actuatorStatus` | Object | ê° ê¸°ê¸°ì˜ ìƒíƒœ ë° ëª¨ë“œ |
| `loading` | Boolean | ì´ˆê¸° ë¡œë”© ìƒíƒœ |
| `refreshing` | Boolean | Pull-to-refresh ìƒíƒœ |
| `autoRefresh` | Boolean | ìë™ ìƒˆë¡œê³ ì¹¨ í™œì„±í™” ì—¬ë¶€ (5ì´ˆ ì£¼ê¸°) |

#### UI êµ¬ì„±
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒ± ë†ì¥ #1                          â”‚
â”‚  ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-10-29 14:30  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š ì„¼ì„œ ë°ì´í„°          [ğŸ”„ ìë™]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸŒ¡ï¸ ì˜¨ë„ â”‚  ğŸ’§ ìŠµë„ â”‚  â˜€ï¸ ì¡°ë„ â”‚   â”‚
â”‚  â”‚  24.5Â°C â”‚  65.0%  â”‚  450 lx â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš™ï¸ ê¸°ê¸° ì œì–´                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ’§ PUMP    [AUTO] [ON] [OFF]  â”‚ â”‚
â”‚  â”‚ ìƒíƒœ: AUTO ëª¨ë“œ                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ’¨ FAN     [AUTO] [ON] [OFF]  â”‚ â”‚
â”‚  â”‚ ìƒíƒœ: ON (ìˆ˜ë™)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ’¡ LED     [AUTO] [ON] [OFF]  â”‚ â”‚
â”‚  â”‚ ìƒíƒœ: OFF (ìˆ˜ë™)               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚  [ğŸ”„ ëª¨ë“  ê¸°ê¸° AUTOë¡œ ì „í™˜]          â”‚
â”‚  [ğŸ“Š ì œì–´ ë¡œê·¸ ë³´ê¸°]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. ActuatorLogs.jsx
> ğŸ“ ê²½ë¡œ: `components/myFarm/ActuatorLogs.jsx`

ê¸°ê¸° ì œì–´ ì´ë ¥ ì¡°íšŒ í™”ë©´

#### ì£¼ìš” ê¸°ëŠ¥
```jsx
// ë¡œê·¸ í•„í„°ë§ ì¡°íšŒ
const loadLogs = async () => {
  const actName = selectedFilter === 'ALL' ? null : selectedFilter;
  const data = await fetchActuatorLogs(raspNum, actName, 100);
  setLogs(data);
};

// ë‚ ì§œ í¬ë§·íŒ…
const formatDate = (dateString) => {
  const date = new Date(dateString);
  return `${month}/${day} ${hours}:${minutes}:${seconds}`;
};

// ê¸°ê¸°ë³„ ì•„ì´ì½˜ ë§¤í•‘
const getDeviceIcon = (actName) => {
  switch (actName) {
    case 'PUMP': return 'ğŸ’§';
    case 'FAN': return 'ğŸ’¨';
    case 'LED': return 'ğŸ’¡';
    default: return 'âš™ï¸';
  }
};

// ëª¨ë“œë³„ ë°°ì§€ ìƒ‰ìƒ
const getModeColor = (mode) => {
  if (mode === 'AUTO') return COLORS.info;     // íŒŒë€ìƒ‰
  if (mode === 'MANUAL') return COLORS.warning; // ì£¼í™©ìƒ‰
  return '#999'; // NULL
};
```

#### UI êµ¬ì„±
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š ì œì–´ ë¡œê·¸                        â”‚
â”‚  [ALL] [PUMP] [FAN] [LED]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ’§ PUMP                      â”‚   â”‚
â”‚  â”‚ ON â†’ OFF                     â”‚   â”‚
â”‚  â”‚ [AUTO] 10/29 14:25:30       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ’¨ FAN                       â”‚   â”‚
â”‚  â”‚ OFF â†’ ON                     â”‚   â”‚
â”‚  â”‚ [MANUAL] 10/29 14:20:15     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ’¡ LED                       â”‚   â”‚
â”‚  â”‚ ON â†’ ON                      â”‚   â”‚
â”‚  â”‚ [AUTO] 10/29 14:15:00       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ API ì„œë¹„ìŠ¤

### actuatorService.js
> ğŸ“ ê²½ë¡œ: `services/actuatorService.js`

ì•¡ì¶”ì—ì´í„° ì œì–´ ë° ì¡°íšŒ API í†µì‹  ë ˆì´ì–´

#### API ì—”ë“œí¬ì¸íŠ¸
```javascript
const API_BASE_URL = 'http://192.168.30.97:8080';
```

#### 1. controlActuator() - ê¸°ê¸° ì œì–´
```javascript
export const controlActuator = async (raspNum, actName, command) => {
  // commandì— ë”°ë¼ ìë™ìœ¼ë¡œ mode ê²°ì •
  const mode = command === 'AUTO' ? 'AUTO' : 'MANUAL';
  
  const url = `${API_BASE_URL}/control/control`;
  const payload = { raspNum, actName, command, mode };
  
  const response = await fetch(url, {
    method: 'POST',
    headers: { 
      'Content-Type': 'application/json',
      'Accept': 'application/json'
    },
    body: JSON.stringify(payload),
  });
  
  if (!response.ok) {
    throw new Error(`ì œì–´ ì‹¤íŒ¨: ${response.status}`);
  }
  
  return await response.json();
};
```

**ìš”ì²­ ì˜ˆì‹œ**:
```json
POST /control/control
{
  "raspNum": "1",
  "actName": "PUMP",
  "command": "ON",
  "mode": "MANUAL"
}
```

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "success": true,
  "message": "ì œì–´ ëª…ë ¹ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

#### 2. fetchActuatorStatus() - ê¸°ê¸° ìƒíƒœ ì¡°íšŒ
```javascript
export const fetchActuatorStatus = async (raspNum, actName) => {
  const response = await fetch(
    `${API_BASE_URL}/control/status?raspNum=${raspNum}&actName=${actName}`
  );
  
  if (!response.ok) throw new Error('ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨');
  return await response.json();
};
```

**ìš”ì²­ ì˜ˆì‹œ**:
```
GET /control/status?raspNum=1&actName=PUMP
```

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "actName": "PUMP",
  "state": "ON",
  "mode": "MANUAL",
  "lastUpdated": "2025-10-29T14:30:00"
}
```

#### 3. fetchActuatorLogs() - ì œì–´ ë¡œê·¸ ì¡°íšŒ
```javascript
export const fetchActuatorLogs = async (raspNum, actName = null, limit = 50) => {
  let url = `${API_BASE_URL}/control/logs?raspNum=${raspNum}&limit=${limit}`;
  if (actName) url += `&actName=${actName}`;
  
  const response = await fetch(url);
  if (!response.ok) throw new Error('ë¡œê·¸ ì¡°íšŒ ì‹¤íŒ¨');
  return await response.json();
};
```

**ìš”ì²­ ì˜ˆì‹œ**:
```
GET /control/logs?raspNum=1&actName=PUMP&limit=100
```

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
[
  {
    "logId": 1234,
    "raspNum": "1",
    "actName": "PUMP",
    "stateBefore": "OFF",
    "stateAfter": "ON",
    "mode": "MANUAL",
    "logTime": "2025-10-29T14:30:00"
  },
  ...
]
```

#### 4. changeMode() - ëª¨ë“œ ì „í™˜
```javascript
export const changeMode = async (raspNum, mode) => {
  const response = await fetch(`${API_BASE_URL}/control/mode`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ raspNum, mode }),
  });
  
  if (!response.ok) throw new Error('ëª¨ë“œ ë³€ê²½ ì‹¤íŒ¨');
  return await response.json();
};
```

---

## ğŸ›  ì‘ì—… íˆìŠ¤í† ë¦¬

### Phase 1: MODE ì»¬ëŸ¼ ë²„ê·¸ ìˆ˜ì • âœ…
**ë¬¸ì œ**: ì•¡ì¶”ì—ì´í„° ë¡œê·¸ì—ì„œ MODEê°€ "ì•Œ ìˆ˜ ì—†ìŒ"ìœ¼ë¡œ í‘œì‹œë¨

**ì›ì¸**: 
- ë°±ì—”ë“œ MyBatis Mapper XMLì—ì„œ MODE ì»¬ëŸ¼ì´ SELECT ì¿¼ë¦¬ì— í¬í•¨ë˜ì§€ ì•ŠìŒ
- DBì—ëŠ” ë°ì´í„°ê°€ ìˆì§€ë§Œ API ì‘ë‹µì—ì„œ ëˆ„ë½

**í•´ê²°**:
```xml
<!-- actuator-control-mapper.xml -->
<select id="getActuatorLogs">
  SELECT 
    LOG_ID as logId,
    RASP_NUM as raspNum,
    ACT_NAME as actName,
    STATE_BEFORE as stateBefore,
    STATE_AFTER as stateAfter,
    MODE as mode,           <!-- âœ… ì¶”ê°€ -->
    LOG_TIME as logTime
  FROM actuator_log
  WHERE RASP_NUM = #{raspNum}
  ORDER BY LOG_TIME DESC
  LIMIT #{limit}
</select>
```

**ê²°ê³¼**: MODE ì»¬ëŸ¼ì´ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë¨ (AUTO/MANUAL)

---

### Phase 2: FAN ëª¨ë“œ ê³ ì • ë²„ê·¸ ìˆ˜ì • ğŸ”§
**ë¬¸ì œ**: FANì´ AUTO ëª¨ë“œë¡œ ì‘ë™í•´ë„ ì•±ì—ì„œ MANUALë¡œë§Œ í‘œì‹œë¨

**ì›ì¸**: 
- Raspberry Piì˜ Python GPIO ì œì–´ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ `log_actuator()` í•¨ìˆ˜ì˜ ê¸°ë³¸ê°’ì´ ì˜ëª» ì„¤ì •ë¨
- `mode="MANUAL"` â†’ ëª¨ë“  ì œì–´ê°€ MANUALë¡œ ê¸°ë¡ë¨

**í•´ê²°** (ì‚¬ìš©ìê°€ ì§ì ‘ ìˆ˜ì •):
```python
# âŒ ì´ì „ ì½”ë“œ
def log_actuator(act_name, state, mode="MANUAL"):
    ...

# âœ… ìˆ˜ì • ì½”ë“œ
def log_actuator(act_name, state, mode="AUTO"):
    ...
```

**ê²°ê³¼**: FANì˜ ì‹¤ì œ ì œì–´ ëª¨ë“œê°€ ì˜¬ë°”ë¥´ê²Œ ê¸°ë¡ë¨

---

### Phase 3: IP ì£¼ì†Œ í†µí•© ğŸŒ
**ë¬¸ì œ**: 
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì—¬ëŸ¬ IP ì£¼ì†Œ í˜¼ìš© (192.168.30.107, 192.168.30.151, 192.168.30.97)
- ì„œë²„ ë³€ê²½ ì‹œë§ˆë‹¤ ìˆ˜ë™ìœ¼ë¡œ IP ë³€ê²½ í•„ìš”

**í•´ê²°**:
- ëª¨ë“  ì„œë¹„ìŠ¤ íŒŒì¼ì˜ API_BASE_URLì„ `192.168.30.97`ë¡œ í†µí•©
- í¬íŠ¸ êµ¬ë¶„: 5000 (í†µí•© API), 8080 (IoT ì œì–´)

**ë³€ê²½ëœ íŒŒì¼ë“¤**:
```
âœ… services/actuatorService.js    â†’ 192.168.30.97:8080
âœ… services/sensorService.js      â†’ 192.168.30.97:5000
âœ… services/boardService.js       â†’ 192.168.30.97:5000
âœ… services/chatService.js        â†’ 192.168.30.97:5000
âœ… services/calendarService.js    â†’ 192.168.30.107:8080 (ë³„ë„ ì„œë²„)
```

---

### Phase 4: JSON Parse ì—ëŸ¬ ì²˜ë¦¬ ğŸ”§
**ë¬¸ì œ**: 
- ìº˜ë¦°ë” APIê°€ ì„±ê³µ ì‹œ JSONì´ ì•„ë‹Œ í…ìŠ¤íŠ¸ ì‘ë‹µ ë°˜í™˜
- `JSON.parse()` ì‹¤íŒ¨ë¡œ ì¸í•œ ì•± í¬ë˜ì‹œ

**ì›ì¸**:
```javascript
// ì„œë²„ ì‘ë‹µ ì˜ˆì‹œ
"ì¼ê¸°ê°€ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤."  // â† ì´ê±´ JSONì´ ì•„ë‹˜!
```

**í•´ê²°**:
```javascript
// calendarService.js
export const addDiary = async (diaryData) => {
  const response = await fetch(`${API_BASE_URL}/diaries`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(diaryData),
  });
  
  const text = await response.text();
  
  if (!response.ok) {
    throw new Error(`ì¼ê¸° ì‘ì„± ì‹¤íŒ¨: ${text}`);
  }
  
  // âœ… JSON íŒŒì‹± ì‹œë„, ì‹¤íŒ¨ ì‹œ í…ìŠ¤íŠ¸ ê·¸ëŒ€ë¡œ ë°˜í™˜
  try {
    return JSON.parse(text);
  } catch (parseError) {
    return { success: true, message: text };
  }
};
```

**ê²°ê³¼**: ì„œë²„ê°€ í…ìŠ¤íŠ¸ë¥¼ ë°˜í™˜í•´ë„ ì•±ì´ ì •ìƒ ì‘ë™

---

### Phase 5: ì‚­ì œ ê¸°ëŠ¥ ì¶”ê°€ ğŸ—‘ï¸
**ë¬¸ì œ**: ìº˜ë¦°ë”ì—ì„œ ì¼ê¸°/ë¬¼ì£¼ê¸° ì¼ì • ì‚­ì œ ê¸°ëŠ¥ ì—†ìŒ

**êµ¬í˜„**:

1. **Service ë ˆì´ì–´**:
```javascript
// calendarService.js
export const deleteDiary = async (diaryId) => {
  const response = await fetch(`${API_BASE_URL}/diaries/${diaryId}`, {
    method: 'DELETE',
  });
  
  const text = await response.text();
  
  if (!response.ok) {
    throw new Error(`ì‚­ì œ ì‹¤íŒ¨: ${text}`);
  }
  
  try {
    return JSON.parse(text);
  } catch {
    return { success: true, message: text };
  }
};

export const deleteWateringSchedule = async (wateringId) => {
  // ë™ì¼í•œ íŒ¨í„´
};
```

2. **Component ë ˆì´ì–´**:
```javascript
// Calendar.jsx
import {
  deleteDiary,              // âœ… ì¶”ê°€
  deleteWateringSchedule,   // âœ… ì¶”ê°€
  ...
} from '../../services/calendarService';

const handleDeleteDiary = async (diaryId) => {
  Alert.alert(
    'ì¼ê¸° ì‚­ì œ',
    'ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
    [
      { text: 'ì·¨ì†Œ', style: 'cancel' },
      {
        text: 'ì‚­ì œ',
        style: 'destructive',
        onPress: async () => {
          try {
            await deleteDiary(diaryId);
            Alert.alert('ì„±ê³µ', 'ì¼ê¸°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            await loadAllData(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          } catch (error) {
            Alert.alert('ì˜¤ë¥˜', 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }
        }
      }
    ]
  );
};
```

3. **UI ì¶”ê°€**:
```jsx
<View style={styles.eventCard}>
  <View style={styles.eventCardContent}>
    <Text style={styles.eventTitle}>{event.title}</Text>
    <Text style={styles.eventTime}>{event.time}</Text>
  </View>
  
  {/* âœ… ì‚­ì œ ë²„íŠ¼ */}
  <TouchableOpacity
    style={styles.deleteButton}
    onPress={() => 
      event.type === 'diary' 
        ? handleDeleteDiary(event.id)
        : handleDeleteWatering(event.id)
    }>
    <Text style={styles.deleteButtonText}>ğŸ—‘ï¸</Text>
  </TouchableOpacity>
</View>
```

**ê²°ê³¼**: ì‚¬ìš©ìê°€ ì¼ê¸°ì™€ ë¬¼ì£¼ê¸° ì¼ì •ì„ ì‚­ì œí•  ìˆ˜ ìˆìŒ

---

### Phase 6: Import ì˜¤ë¥˜ ìˆ˜ì • ğŸ›
**ë¬¸ì œ**: 
- ì‚­ì œ ê¸°ëŠ¥ êµ¬í˜„ í›„ `deleteDiary`ì™€ `deleteWateringSchedule`ê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ ì˜¤ë¥˜
- import ë¬¸ì—ì„œ í•¨ìˆ˜ê°€ ëˆ„ë½ë¨

**ì›ì¸**: 
- íŒŒì¼ì´ í¸ì§‘ë˜ë©´ì„œ import ë¬¸ì´ ì´ˆê¸°í™”ë¨ (í¬ë§·í„° ë˜ëŠ” ìˆ˜ë™ í¸ì§‘)

**í•´ê²°**:
```javascript
// âŒ ì´ì „ (ì˜¤ë¥˜ ë°œìƒ)
import {
  addDiary as apiAddDiary,
  addWateringSchedule as apiAddWatering,
  fetchDiaries,
  fetchWateringSchedules
} from '../../services/calendarService';

// âœ… ìˆ˜ì • (ì •ìƒ ì‘ë™)
import {
  addDiary as apiAddDiary,
  addWateringSchedule as apiAddWatering,
  deleteDiary,                    // âœ… ì¶”ê°€
  deleteWateringSchedule,         // âœ… ì¶”ê°€
  fetchDiaries,
  fetchWateringSchedules
} from '../../services/calendarService';
```

**ê²°ê³¼**: ì‚­ì œ ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™

---

## ğŸ”¥ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ì„¼ì„œ ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠìŒ

**ì¦ìƒ**:
- ì„¼ì„œ ë°ì´í„°ê°€ ë©°ì¹  ì „ ë°ì´í„°ë¡œ ê³ ì •ë¨
- "âš ï¸ 3ì¼ ì „ ë°ì´í„°" ë©”ì‹œì§€ í‘œì‹œ

**ì›ì¸**:
- Raspberry Pi ì„¼ì„œ ìˆ˜ì§‘ í”„ë¡œì„¸ìŠ¤ê°€ ì¤‘ë‹¨ë¨
- DBì— ìƒˆë¡œìš´ ë°ì´í„°ê°€ ì €ì¥ë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
1. Raspberry Pi SSH ì ‘ì†
2. ì„¼ì„œ ìˆ˜ì§‘ ìŠ¤í¬ë¦½íŠ¸ ì¬ì‹œì‘
3. í”„ë¡œì„¸ìŠ¤ ìƒíƒœ í™•ì¸: `ps aux | grep sensor`

---

### ë¬¸ì œ 2: ê¸°ê¸° ì œì–´ ëª…ë ¹ì´ ì‘ë™í•˜ì§€ ì•ŠìŒ

**ì¦ìƒ**:
- ë²„íŠ¼ í´ë¦­ ì‹œ "ì œì–´ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤" ì•Œë¦¼
- ì½˜ì†”ì— ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì¶œë ¥

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
```
â–¡ Raspberry Pi ì „ì›ì´ ì¼œì ¸ ìˆëŠ”ê°€?
â–¡ Spring Boot ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ê°€?
â–¡ ë„¤íŠ¸ì›Œí¬ê°€ ì—°ê²°ë˜ì–´ ìˆëŠ”ê°€? (ê°™ì€ Wi-Fi)
â–¡ ë°©í™”ë²½ì´ 8080 í¬íŠ¸ë¥¼ ì°¨ë‹¨í•˜ê³  ìˆì§€ ì•Šì€ê°€?
â–¡ API_BASE_URLì´ ì˜¬ë°”ë¥¸ IPì¸ê°€?
```

**ë””ë²„ê¹…**:
```javascript
// actuatorService.jsì—ì„œ ë¡œê·¸ í™•ì¸
console.log('ğŸ“¡ controlActuator í˜¸ì¶œ');
console.log('  URL:', url);
console.log('  Payload:', JSON.stringify(payload));
console.log('  ì‘ë‹µ ìƒíƒœ:', response.status);
```

**í•´ê²°**:
1. ì„œë²„ ì¬ì‹œì‘: `sudo systemctl restart spring-boot`
2. ë„¤íŠ¸ì›Œí¬ í™•ì¸: `ping 192.168.30.97`
3. API ì§ì ‘ í…ŒìŠ¤íŠ¸: Postman ë˜ëŠ” curl ì‚¬ìš©

---

### ë¬¸ì œ 3: MODEê°€ NULLë¡œ í‘œì‹œë¨

**ì¦ìƒ**:
- ë¡œê·¸ì—ì„œ MODE ë°°ì§€ê°€ "?" í‘œì‹œ
- DBì—ì„œ MODE ì»¬ëŸ¼ì´ NULL

**ì›ì¸**:
- Python GPIO ìŠ¤í¬ë¦½íŠ¸ì—ì„œ `log_actuator()` í˜¸ì¶œ ì‹œ mode íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•˜ì§€ ì•ŠìŒ

**í•´ê²°**:
```python
# Python GPIO ì œì–´ ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •
def control_pump(state):
    GPIO.output(PUMP_PIN, not state)  # ACTIVE_LOW
    current_mode = get_current_mode()  # AUTO ë˜ëŠ” MANUAL í™•ì¸
    log_actuator('PUMP', 'ON' if state else 'OFF', mode=current_mode)
    #                                                ^^^^^^^^^^^^^^^^^^
```

---

### ë¬¸ì œ 4: ìë™ ìƒˆë¡œê³ ì¹¨ì´ ë„ˆë¬´ ìì£¼ ë°œìƒí•¨

**ì¦ìƒ**:
- ì•± ë°°í„°ë¦¬ ì†Œëª¨ê°€ í¼
- ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ê³¼ë‹¤

**í•´ê²°**:
```javascript
// FarmManagement.jsx
const REFRESH_INTERVAL = 5000; // 5ì´ˆ â†’ 10ì´ˆë¡œ ë³€ê²½

// ë˜ëŠ” ìë™ ìƒˆë¡œê³ ì¹¨ ë¹„í™œì„±í™”
const [autoRefresh, setAutoRefresh] = useState(false);
```

---

## ğŸš€ í–¥í›„ ê°œì„ ì‚¬í•­

### 1. ì‚¬ìš©ì ì¸ì¦ ì—°ë™
**í˜„ì¬**:
```javascript
const raspNum = "1"; // í•˜ë“œì½”ë”©ëœ ë†ì¥ ë²ˆí˜¸
```

**ê°œì„ **:
```javascript
import { useAuth } from '../../contexts/AuthContext';

const { user } = useAuth();
const raspNum = user?.farmId || "1";
```

---

### 2. ì‹¤ì‹œê°„ ì•Œë¦¼ ê¸°ëŠ¥
**ëª©í‘œ**:
- ì„¼ì„œ ê°’ì´ ìœ„í—˜ ìˆ˜ì¤€ì¼ ë•Œ í‘¸ì‹œ ì•Œë¦¼
- ê¸°ê¸° ê³ ì¥ ì‹œ ì¦‰ì‹œ ì•Œë¦¼

**êµ¬í˜„ ë°©ì•ˆ**:
- Firebase Cloud Messaging ì—°ë™
- WebSocket ë˜ëŠ” Server-Sent Events ì‚¬ìš©

---

### 3. ë°ì´í„° ì‹œê°í™”
**ëª©í‘œ**:
- ì„¼ì„œ ë°ì´í„° ê·¸ë˜í”„ (ì‹œê°„ëŒ€ë³„ ì˜¨ë„/ìŠµë„ ë³€í™”)
- ê¸°ê¸° ê°€ë™ ì‹œê°„ í†µê³„

**ë¼ì´ë¸ŒëŸ¬ë¦¬**:
- `react-native-chart-kit`
- `victory-native`

**ì˜ˆì‹œ ì½”ë“œ**:
```jsx
import { LineChart } from 'react-native-chart-kit';

<LineChart
  data={{
    labels: ['00:00', '06:00', '12:00', '18:00'],
    datasets: [{ data: [22.5, 24.0, 26.5, 25.0] }]
  }}
  width={screenWidth}
  height={220}
  chartConfig={{
    backgroundColor: COLORS.primary,
    decimalPlaces: 1,
  }}
/>
```

---

### 4. ì˜ˆì•½ ì œì–´
**ëª©í‘œ**:
- íŠ¹ì • ì‹œê°„ì— ê¸°ê¸° ìë™ ON/OFF
- ë°˜ë³µ ìŠ¤ì¼€ì¤„ ì„¤ì • (ë§¤ì¼ ì˜¤ì „ 9ì‹œ LED ON)

**DB ì„¤ê³„**:
```sql
CREATE TABLE actuator_schedule (
  SCHEDULE_ID INT PRIMARY KEY AUTO_INCREMENT,
  RASP_NUM VARCHAR(10),
  ACT_NAME VARCHAR(20),
  COMMAND VARCHAR(10),
  SCHEDULED_TIME TIME,
  REPEAT_TYPE ENUM('ONCE', 'DAILY', 'WEEKLY'),
  IS_ACTIVE TINYINT(1)
);
```

---

### 5. ì—ë„ˆì§€ ì ˆì•½ ëª¨ë“œ
**ëª©í‘œ**:
- ì•¼ê°„ ì‹œê°„ëŒ€ ìë™ LED OFF
- í† ì–‘ ìˆ˜ë¶„ì´ ì¶©ë¶„í•  ë•Œ PUMP ìë™ OFF

**êµ¬í˜„**:
```javascript
const checkEnergySavingMode = () => {
  const hour = new Date().getHours();
  const isNight = hour >= 22 || hour < 6;
  
  if (isNight && actuatorStatus.LED?.state === 'ON') {
    handleActuatorControl('LED', 'OFF');
    console.log('âš¡ ì—ë„ˆì§€ ì ˆì•½: LED ìë™ êº¼ì§');
  }
};
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

### API ë¬¸ì„œ
- Spring Boot REST API: http://192.168.30.97:8080/swagger-ui.html
- Raspberry Pi GPIO: https://pinout.xyz/

### ê´€ë ¨ íŒŒì¼
```
ğŸ“ components/myFarm/
  â”œâ”€â”€ FarmManagement.jsx      # ë†ì¥ ê´€ë¦¬ ë©”ì¸
  â”œâ”€â”€ ActuatorLogs.jsx         # ì œì–´ ë¡œê·¸
  â””â”€â”€ Calendar.jsx             # ì¼ì • ê´€ë¦¬

ğŸ“ services/
  â”œâ”€â”€ actuatorService.js       # ì•¡ì¶”ì—ì´í„° API
  â”œâ”€â”€ sensorService.js         # ì„¼ì„œ API
  â””â”€â”€ calendarService.js       # ìº˜ë¦°ë” API

ğŸ“ constants/
  â””â”€â”€ myFarmConstant.js        # ìƒ‰ìƒ/ìŠ¤íƒ€ì¼ ìƒìˆ˜
```

### DB ìŠ¤í‚¤ë§ˆ
```sql
-- ì•¡ì¶”ì—ì´í„° ë¡œê·¸ í…Œì´ë¸”
CREATE TABLE actuator_log (
  LOG_ID INT PRIMARY KEY AUTO_INCREMENT,
  RASP_NUM VARCHAR(10),
  ACT_NAME VARCHAR(20),
  STATE_BEFORE VARCHAR(10),
  STATE_AFTER VARCHAR(10),
  MODE ENUM('AUTO', 'MANUAL'),
  LOG_TIME DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- ì„¼ì„œ ë°ì´í„° í…Œì´ë¸”
CREATE TABLE sensor (
  SENSOR_ID INT PRIMARY KEY AUTO_INCREMENT,
  RASP_NUM VARCHAR(10),
  TEMPERATURE DECIMAL(5,2),
  HUMIDITY DECIMAL(5,2),
  ILLUMINANCE INT,
  SOIL_MOISTURE INT,
  SENSOR_TIME DATETIME
);
```

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê°œë°œ ì™„ë£Œ í•­ëª©
- [x] ì„¼ì„œ ë°ì´í„° ì‹¤ì‹œê°„ ì¡°íšŒ
- [x] ê¸°ê¸° ON/OFF ì œì–´
- [x] AUTO/MANUAL ëª¨ë“œ ì „í™˜
- [x] ì œì–´ ë¡œê·¸ ì¡°íšŒ ë° í•„í„°ë§
- [x] Pull-to-refresh ê¸°ëŠ¥
- [x] ìë™ ìƒˆë¡œê³ ì¹¨ (5ì´ˆ ì£¼ê¸°)
- [x] ëª¨ë“  ê¸°ê¸° AUTO ì´ˆê¸°í™”
- [x] MODE ì»¬ëŸ¼ ë²„ê·¸ ìˆ˜ì •
- [x] JSON Parse ì—ëŸ¬ ì²˜ë¦¬
- [x] ì¼ê¸°/ë¬¼ì£¼ê¸° ì‚­ì œ ê¸°ëŠ¥

### ì§„í–‰ ì¤‘ í•­ëª©
- [ ] Python GPIO mode ê¸°ë³¸ê°’ ìˆ˜ì • (ì‚¬ìš©ì ì‘ì—…)
- [ ] ì„¼ì„œ ë°ì´í„° ê·¸ë˜í”„ ì‹œê°í™”
- [ ] ì‚¬ìš©ìë³„ ë†ì¥ ë²ˆí˜¸ ì—°ë™

### ë¯¸ì°©ìˆ˜ í•­ëª©
- [ ] ì‹¤ì‹œê°„ ì•Œë¦¼ ê¸°ëŠ¥
- [ ] ì˜ˆì•½ ì œì–´ ê¸°ëŠ¥
- [ ] ì—ë„ˆì§€ ì ˆì•½ ëª¨ë“œ
- [ ] ë‹¤êµ­ì–´ ì§€ì›

---

**ì‘ì„±ì¼**: 2025ë…„ 10ì›” 29ì¼  
**ì‘ì„±ì**: GitHub Copilot  
**ë²„ì „**: 1.0.0  
**ìµœì¢… ìˆ˜ì •**: import ì˜¤ë¥˜ ìˆ˜ì • ì™„ë£Œ
