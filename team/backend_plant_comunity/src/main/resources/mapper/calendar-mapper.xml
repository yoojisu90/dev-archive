<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.green.backend_plant_comunity.calendar.mapper.CalendarMapper">
    
    <!-- ResultMap 정의 -->
    <resultMap id="diary" type="com.green.backend_plant_comunity.calendar.dto.CalendarDTO">
        <id property="diaryId" column="DIARY_ID"/>
        <result property="memId" column="MEM_ID"/>
        <result property="diaryTitle" column="DIARY_TITLE"/>
        <result property="diaryContent" column="DIARY_CONTENT"/>
        <result property="diaryDate" column="DIARY_DATE"/>
        <result property="createdAt" column="CREATED_AT"/>
        <result property="updatedAt" column="UPDATED_AT"/>
    </resultMap>

    <!-- 일기 목록 조회 -->
    <select id="getDiaries" resultMap="diary">
        SELECT 
            DIARY_ID,
            MEM_ID,
            DIARY_TITLE,
            DIARY_CONTENT,
            DIARY_DATE,
            CREATED_AT,
            UPDATED_AT
        FROM DIARY
        WHERE MEM_ID = #{memId}
        ORDER BY DIARY_DATE DESC
    </select>

    <!-- 일기 작성 -->
    <insert id="insertDiary">
        INSERT INTO DIARY (
            MEM_ID,
            DIARY_TITLE,
            DIARY_CONTENT,
            DIARY_DATE
        ) VALUES (
            #{memId},
            #{diaryTitle},
            #{diaryContent},
            #{diaryDate}
        )
    </insert>

    <!-- 일기 수정 -->
    <update id="updateDiary">
        UPDATE DIARY
        SET 
            DIARY_TITLE = #{diaryTitle},
            DIARY_CONTENT = #{diaryContent}
        WHERE DIARY_ID = #{diaryId}
    </update>

    <!-- 일기 삭제 -->
    <delete id="deleteDiary">
        DELETE FROM DIARY
        WHERE DIARY_ID = #{diaryId}
    </delete>

    <!-- 특정 날짜에 일기가 존재하는지 확인 -->
    <select id="checkDiaryExists" resultType="int">
        SELECT COUNT(*)
        FROM DIARY
        WHERE MEM_ID = #{memId}
        AND DIARY_DATE = #{diaryDate}
    </select>

</mapper>
